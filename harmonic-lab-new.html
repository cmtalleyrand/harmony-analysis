<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Harmonic Analysis Lab</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Menlo', 'Consolas', 'Monaco', monospace; font-size: 13px; background: #1a1a2e; color: #e0e0e0; padding: 20px; }
  .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
  h1 { font-size: 18px; color: #7ec8e3; }
  .build-tag { font-size:11px; color:#8c95aa; border:1px solid #2a3346; border-radius:999px; padding:2px 8px; }
  .layout { display: grid; grid-template-columns: minmax(360px, 460px) 1fr; gap: 14px; align-items: start; }
  .panel { background: #111829; border: 1px solid #27334e; border-radius: 8px; padding: 12px; }
  .controls { margin-bottom: 10px; }
  .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 8px; }
  label { color: #aaa; }
  input, select, button { font-family: inherit; font-size: 13px; background: #16213e; color: #e0e0e0; border: 1px solid #444; padding: 6px 10px; border-radius: 4px; }
  input:focus, select:focus { outline: none; border-color: #7ec8e3; }
  input.wide { width: 100%; max-width: 430px; }
  button { background: #0f3460; cursor: pointer; border-color: #7ec8e3; }
  button:hover { background: #1a4a7a; }
  .presets { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 14px; }
  .presets button { font-size: 11px; padding: 3px 8px; background: #1a1a3e; }
  .help { color: #8c95aa; font-size: 11px; margin-bottom: 10px; line-height: 1.5; }
  #summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 8px; margin-bottom: 10px; }
  .summary-card { background: #0f0f1a; border: 1px solid #333; border-radius: 6px; padding: 10px; }
  .summary-card .hdr { color: #7ec8e3; margin-bottom: 5px; }
  .summary-card .best { color: #9be37e; }
  #output { background: #0f0f1a; border: 1px solid #333; border-radius: 6px; padding: 12px; line-height: 1.5; max-height: 76vh; overflow-y: auto; }
  .summary-chips { display:flex; flex-wrap:wrap; gap:8px; }
  .summary-chip { background:#0f0f1a; border:1px solid #333; border-radius:999px; padding:5px 10px; color:#c8d4f0; font-size:12px; }
  .run-block { margin-bottom: 14px; }
  .run-block h3 { color:#9bd0f4; margin: 4px 0 8px; font-size: 13px; }
  .result-table { width:100%; border-collapse: collapse; margin-bottom: 8px; font-size: 12px; }
  .result-table th, .result-table td { border:1px solid #2a3346; padding:6px 8px; text-align:left; vertical-align: top; }
  .result-table th { background:#17233b; color:#9bd0f4; }
  .result-table.compact td, .result-table.compact th { text-align:center; }
  .raw-log summary { cursor:pointer; color:#7ec8e3; margin:6px 0; }
  .raw-log pre { white-space: pre; overflow-x:auto; font-size:11px; color:#d5d7df; }
  .empty { color:#8c95aa; }
  #error { color: #ff6b6b; margin-bottom: 8px; min-height: 1.2em; }
  @media (max-width: 1100px) { .layout { grid-template-columns: 1fr; } }
</style>
</head>
<body>
<h1>Harmonic Analysis Lab</h1>
<div class="layout">
  <section class="panel">
    <div class="controls">
      <div class="row">
        <label>Voice 1: <input id="v1" class="wide" value="C4 E4 G4 B4 A4 F4 A4 C5" /></label>
        <label>Dur:
          <select id="dur1">
            <option value="2">Half</option>
            <option value="1" selected>Quarter</option>
            <option value="0.5">Eighth</option>
            <option value="0.25">Sixteenth</option>
          </select>
        </label>
        <label>Meter:
          <select id="timeSig">
            <option value="4/4" selected>4/4</option>
            <option value="3/4">3/4</option>
            <option value="5/4">5/4</option>
            <option value="6/8">6/8</option>
            <option value="7/8">7/8</option>
          </select>
        </label>
      </div>
      <div class="row">
        <label>Voice 2: <input id="v2" class="wide" value="" placeholder="(optional) e.g. G3 C4 E4 D4" /></label>
        <label>Dur:
          <select id="dur2">
            <option value="2">Half</option>
            <option value="1" selected>Quarter</option>
            <option value="0.5">Eighth</option>
            <option value="0.25">Sixteenth</option>
          </select>
        </label>
      </div>
      <div class="row">
        <button onclick="doRunAll()">Run all durations (voice 1 only)</button>
        <button onclick="doRunOne()">Run selected durations</button>
      </div>
    </div>
    <div class="help">
      Notes in SPN: C4, Eb3, F#5, Bb2. Optional per-note duration multiplier (e.g. C44, Eb46).<br/>
      Optional length declaration: <code>L:1/16 C⁴4 Eb⁴6 Gb⁴6</code> where 4/6 multiply the base length.<br/>
      Superscript octave input is supported (e.g. C⁴). Middle C = C4.
    </div>
    <div class="presets">
      <label>Presets:</label>
      <button onclick="preset('C4 E4 G4 B4 A4 F4 A4 C5','')">C E G B A F A C</button>
      <button onclick="preset('C4 E4 G4','')">C E G</button>
      <button onclick="preset('C4 E4 G4 B4','')">C E G B</button>
      <button onclick="preset('C4 D4 E4 F4 G4 A4 B4 C5','')">Scale</button>
      <button onclick="preset('C4 E4 G4 B4','G3 C4 E4 D4')">CEGB + bass</button>
      <button onclick="preset('E4 F4 G4 A4 B4 C5','C3 C3 C3 G2 G2 C3')">Melody + bass</button>
    </div>
    <div id="error"></div>
  </section>

  <section class="panel">
    <div id="summary"></div>
    <div id="output">Click "Run" to start.</div>
  </section>
</div>

<script type="module">
import { initHarmonicLab } from './src/app/main.js';
initHarmonicLab();
</script>
</body>
</html>
